///////////////////////////////////////////////////////////////////////
////                        IMPORTS                                ////
///////////////////////////////////////////////////////////////////////

const dotenv = require('dotenv');
const fs = require('fs');
// const readline = require('readline');
const word2pdf = require('word2pdf');
const express = require('express');
const cors = require('cors');
var glob = require("glob");
var app = express();
var readline = require('readline');
var HTMLParser = require('node-html-parser');
const docx = require("docx");
const { Paragraph, HeadingLevel, ImageRun, TextRun, Document, Packer, SectionType, TableRow, Table, TableCell, HeightRule, VerticalAlign, WidthType, Footer, Header, PageNumber } = require('docx');
var req_type = 'http';

////////////////////////////////////////////////////////////////////////
////                        CONFIG                                  ////    
////////////////////////////////////////////////////////////////////////

//To use cors
app.use(cors());
const execSync = require('child_process').execSync;

//to use environment variables from .env file
// dotenv.config();
// console.log(process.env.USER_SSH);
// var SCRIPT_ARGS = `userdb=${process.env.USER_LIST},passdb=${process.env.SHORT_P}`
// console.log(SCRIPT_ARGS);

var target = "192.168.1.1";
var company;
var company_domain, admin_email;

function main(){
    console.log("Started IG.sh");
    var dir = new Date().toISOString() + '_Report';
    var filepath = dir + '_' + target;
    // execSync(`mkdir ${filepath}; mkdir ${filepath}/IG`);
    // const resu = execSync(`bash IG2.sh ${filepath}/IG/nmap_result ${filepath}/IG/dirb_result.txt`,{stdio: "ignore"});
    const resu = execSync(`bash IG2.sh ${target} ${admin_email}`,{stdio: "ignore"});
    

    var rows = [];
    var header_row = new TableRow({
        children: [
            new TableCell({
                children: [
                    new Paragraph({
                        children: [
                            new TextRun({
                                text: "CVE ID",
                                bold: true
                            })
                        ],
                        alignment: "center"
                    })
                ]
            }),
            new TableCell({
                children: [
                    new Paragraph({
                        children: [
                            new TextRun({
                                text: "CVSS Score",
                                bold: true
                            })
                        ],
                        alignment: "center"
                    })
                ]
            }),
            new TableCell({
                children: [
                    new Paragraph({
                        children: [
                            new TextRun({
                                text: "Definition",
                                bold: true
                            })
                        ],
                        alignment: "center"
                    })
                ]
            }),
        ]
    });
    rows.push(header_row);



    const hsts_file = readline.createInterface({
        input: fs.createReadStream('hsts.txt'),
        output: process.stdout,
        terminal: false
    });

    const dirb_file = readline.createInterface({
        input: fs.createReadStream(`${target}/recon/scans/directory_result.txt`),
        output: process.stdout,
        terminal: false
    });

    var hsts_check = false, hsts_message = "The target was found to have missing the Strict Transport Security Protocol otherwise known as HSTS which prevents HTTPS downgrading attacks in Man-in-the-middle (MITM) scenarios. This is a really dangerous vulnerability and needs to be fixed at the earliest."
    console.log("Before hsts check ... ");
    hsts_file.on('line', (line)=>{
        hsts_check = true;
    }).on('close', ()=>{
        if(hsts_check == true){
            hsts_message = "The target has Strict Transport Security protocol which is a good sign for the security of the website."
        }
        console.log("Hsts file closed...");

        const breach_file = readline.createInterface({
            input: fs.createReadStream('breach.txt'),
            output: process.stdout,
            terminal: false
        });
        var b_count = 0, b_data = [], breach;
        const b_header = new TableRow({
            children: [
                new TableCell({
                    children: [
                        new Paragraph({
                            children: [
                                new TextRun({
                                    text: "User Email",
                                    bold: true
                                })
                            ],
                            alignment: "center"
                        })
                    ],
                    verticalAlign: VerticalAlign.CENTER
                }),
                new TableCell({
                    children: [
                        new Paragraph({
                            children: [
                                new TextRun({
                                    text: "Database",
                                    bold: true
                                })
                            ],
                            alignment: "center"
                        })
                    ],
                    verticalAlign: VerticalAlign.CENTER
                }),
                new TableCell({
                    children: [
                        new Paragraph({
                            children: [
                                new TextRun({
                                    text: "Breach Site",
                                    bold: true
                                })
                            ],
                            alignment: "center"
                        })
                    ],
                    verticalAlign: VerticalAlign.CENTER
                }),
            ],
            height: {value: 500, rule: HeightRule.ATLEAST}
        });
        b_data.push(b_header);
        breach_file.on('line', (line)=>{
            b_count ++;
            if(b_count > 1){
                const b_split = line.split(',');
                const email = b_split[0], database = b_split[1], data = b_split[2];
                const row = new TableRow({
                    children: [
                        new TableCell({
                            children: [
                                new Paragraph({
                                    text: email,
                                    alignment: "center"
                                })
                            ],
                            verticalAlign: VerticalAlign.CENTER
                        }),
                        new TableCell({
                            children: [
                                new Paragraph({
                                    text: database,
                                    alignment: "center"
                                })
                            ],
                            verticalAlign: VerticalAlign.CENTER
                        }),
                        new TableCell({
                            children: [
                                new Paragraph({
                                    text: data,
                                    alignment: "center"
                                })
                            ],
                            verticalAlign: VerticalAlign.CENTER
                        }),
                    ],
                    height: {value: 500, rule: HeightRule.ATLEAST}
                });
                b_data.push(row);
            }
        }).on('close', ()=>{
            if(b_data.length > 1){
                breach = new Table({
                    width: {
                        size: 9500,
                        type: WidthType.DXA
                    },
                    rows: b_data
                })
            } else {
                breach = new Paragraph({
                    text: "No breaches were found during the Open Source Intelligence (OSINT) phase. This is a good sign for the company.",
                    style: "default"
                });
            }
            
            const file = readline.createInterface({
                input: fs.createReadStream('report_input.txt'),
                output: process.stdout,
                terminal: false
            });
            file.on('line', (line)=>{
                const linearray = line.split(" : ");
                const cve = linearray[0];
                const cvss = linearray[1];
                const description = linearray[2];
                const row = new TableRow({
                    children: [
                        new TableCell({
                            children: [
                                new Paragraph({
                                    text: cve
                                })
                            ],
                            verticalAlign: VerticalAlign.CENTER
                        }),
                        new TableCell({
                            children: [
                                new Paragraph({
                                    text: cvss
                                })
                            ],
                            verticalAlign: VerticalAlign.CENTER
                        }),
                        new TableCell({
                            children: [
                                new Paragraph({
                                    text: description
                                })
                            ],
                            verticalAlign: VerticalAlign.CENTER
                        }),
                    ],
                    height: {value: 500, rule: HeightRule.ATLEAST}
                });
                rows.push(row);
            }).on('close', ()=>{
                let vulns;
                if(rows.length > 1){
                    vulns = new Table({
                        width: {
                            size: 9500,
                            type: WidthType.DXA
                        },
                        rows: rows
                    })
                } else {
                    vulns = new Paragraph({
                        text: "No Common Vulnerabilities were found during the vulnerability assessment. This is a good sign for the company.",
                        style: "default"
                    });
                }
                const pythonProcess = execSync('python3 ML_script.py');
                console.log("Output from ML script is -> \n");
                console.log(pythonProcess.toString());

                const ml_op = pythonProcess.toString().split(":");
                const conf_score = ml_op[0], conf_rating = ml_op[1], cyberrisk = ml_op[2], cyber_rating = ml_op[3];
            
                const image = new ImageRun({
                    data: fs.readFileSync("/home/anathema/Desktop/cmkllogo.png"),
                    transformation: {
                        width: 400,
                        height: 300,
                    },
                });
                const doc = new docx.Document({
                    creator: "CMKL",
                    description: "Created by CMKL Security Research Team",
                    title: "Report for ",
                    styles: {
                        default: {
                            heading1: {
                                run:{
                                    size: 36,
                                    bold: true,
                                    font: "Century Gothic"
                                },
                                paragraph: {
                                    spacing: {
                                        after: 200
                                    }
                                }
                            },
                            heading2: {
                                run: {
                                    size: 28,
                                    bold: true,
                                    font: "Century Gothic"
                                },
                                paragraph: {
                                    spacing: {after: 230}
                                }
                            },
                            document:{run : {size: 24, font: "Franklin Gothic Book"}}
                        },
                        paragraphStyles:[
                        {
                            id:"default",
                            name:"Default",
                            run:{
                                size: 24,
                            },
                            paragraph: {
                                spacing: {
                                    after: 250
                                },
                            }
                        },
                        {
                            id: "2",
                            name: "two",
                            run: {
                                size: 24
                            }
                        }
                    ]
                    },
                    sections: [
                        {
                        children: [
                            new Paragraph({
                                children: [
                                    image
                                ],
                                alignment: "center"
                            }),
                            new Paragraph(
                                {
                                    text: company,
                                    heading: HeadingLevel.TITLE,
                                    alignment: "center"
                                }
                            ),
                            new Paragraph(
                                {
                                    text: "Security Assessment Findings Report",
                                    heading: HeadingLevel.HEADING_1,
                                    alignment: "center"
                                },
                                
                            )
                        ],
                    },
                    {
                        properties: {type: SectionType.NEXT_PAGE},
                        headers :{
                            default: new Header({
                                children: [
                                    new Paragraph({
                                        border: {
                                            bottom: {
                                                    color: "auto",
                                                    space: 1,
                                                    value: "single",
                                                    size: 6,
                                            }
                                        },
                                        children: [
                                            new ImageRun({
                                                data: fs.readFileSync("/home/anathema/Desktop/cmkllogo.png"),
                                                transformation: {
                                                    width: 90,
                                                    height: 90
                                                }
                                            })
                                        ],
                                        alignment: "right"
                                    })
                
                                ]
                            })
                        },
                        footers: {
                            default: new Footer({
                                children: [
                                    new Paragraph({
                                        border: {
                                            top: {
                                                color: "auto",
                                                space: 1,
                                                value: "single",
                                                size: 6
                                            }
                                        },
                                        children: [
                                            new TextRun({
                                                text: company,
                                                bold: true,
                                            })
                                        ],
                                        
                                        alignment: "center",
                
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                text: "BUSINESS CONFIDENTIAL"
                                            }),
                                        ],
                                        alignment: "center"
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                children: ["Page ", PageNumber.CURRENT],
                                            }),
                                            new TextRun({
                                                children: [" of ", PageNumber.TOTAL_PAGES],
                                            })
                                        ],
                                        alignment: "right"
                                    })
                                ],
                            }),
                            
                        },
                        children: [
                            new Paragraph({
                                text: "Confidentiality Statement",
                                heading: HeadingLevel.HEADING_1,  
                            }),
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: `This document is the exclusive property of ${company} and CMKL Security Researchers. This document contains proprietary and confidential information. Duplication, redistribution, or use, in whole or in part, in any form, requires consent of both ${company} and CMKL.`,
                                        size: 24,
                                    }),              
                            ],
                            spacing: {after: 150}
                            }),
                            new Paragraph({
                                children: [
                                    new TextRun("CMKL may share this document with auditors under non-disclosure agreements to demonstrate penetration test requirement compliance."),
                                ],
                                style: "default"
                            }),
                            new Paragraph({
                                text: "Disclaimer",
                                heading: HeadingLevel.HEADING_1
                            }),
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: "A penetration test is considered a snapshot in time. The findings and recommendations reflect the information gathered during the assessment and not any changes or modifications made outside of that period.",
                                        size: 24
                                    }),
                                    
                                ],
                                spacing: {after: 150}
                            }),
                            new Paragraph({
                                children: [
                                    new TextRun("Time-limited engagements do not allow for a full evaluation of all security controls. CMKL prioritized the assessment to identify the weakest security controls an attacker would exploit. CMKL recommends conducting similar assessments on an annual basis by internal or third-party assessors to ensure the continued success of the controls.")
                                ],
                                style: "default"
                            }),
                            new Paragraph({
                                text: "Contact Information",
                                heading: HeadingLevel.HEADING_1,  
                            }),
                            new Table({
                                width: {
                                    size: 9500,
                                    type: WidthType.DXA
                                },
                                rows:[
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Name",
                                                                bold: true,
                                                                size: 24
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ]
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Title",
                                                                bold: true,
                                                                size: 24
                                                            })
                                                        ],
                                                        alignment: "center",
                                                        
                                                    })
                                                ]
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Contact Information",
                                                                bold: true,
                                                                size: 24
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ]
                                            })
                                        ]
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Orathai Sangpetch",
                                                                size: 24
                                                            })
                                                        ],
                                                        // spacing: {after: 80, before: 80},
                                                        alignment: "left"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Project Coordinator",
                                                                size: 24,
                                                                
                                                            })
                                                        ],
                                                        alignment: "left",
                                                        // spacing: {after: 80, before: 80}
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "orathai@cmkl.ac.th",
                                                                size: 24
                                                            })
                                                        ],
                                                        alignment: "left",
                                                        // spacing: {before: 80, after: 80}
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height:{value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Akkarit Sangpetch",
                                                                size: 24
                                                            })
                                                        ],
                                                        // spacing: {after: 80, before: 80},
                                                        alignment: "left"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Project Coordinator",
                                                                size: 24,
                                                                
                                                            })
                                                        ],
                                                        alignment: "left",
                                                        // spacing: {after: 80, before: 80}
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "akkarit@cmkl.ac.th",
                                                                size: 24
                                                            })
                                                        ],
                                                        alignment: "left",
                                                        // spacing: {before: 80, after: 80}
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height:{value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Ayesh Towheed",
                                                                size: 24
                                                            })
                                                        ],
                                                        // spacing: {after: 80, before: 80},
                                                        alignment: "left"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Penetration Tester",
                                                                size: 24,
                                                                
                                                            })
                                                        ],
                                                        alignment: "left",
                                                        // spacing: {after: 80, before: 80}
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "mtowheed@cmkl.ac.th",
                                                                size: 24
                                                            })
                                                        ],
                                                        alignment: "left",
                                                        // spacing: {before: 80, after: 80}
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height:{value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Khanin Udomchoksakul",
                                                                size: 24
                                                            })
                                                        ],
                                                        // spacing: {after: 80, before: 80},
                                                        alignment: "left"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Data Scientist",
                                                                size: 24,
                                                                
                                                            })
                                                        ],
                                                        alignment: "left",
                                                        // spacing: {after: 80, before: 80}
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children:[
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "kudomcho@cmkl.ac.th",
                                                                size: 24
                                                            })
                                                        ],
                                                        alignment: "left",
                                                        // spacing: {before: 80, after: 80}
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height:{value: 500, rule: HeightRule.ATLEAST}
                                    })
                                ]
                            })
                        ]
                    },
                    {
                        properties: {
                            type: SectionType.NEXT_PAGE
                        },
                        headers :{
                            default: new Header({
                                children: [
                                    new Paragraph({
                                        border: {
                                            bottom: {
                                                    color: "auto",
                                                    space: 1,
                                                    value: "single",
                                                    size: 6,
                                            }
                                        },
                                        children: [
                                            new ImageRun({
                                                data: fs.readFileSync("/home/anathema/Desktop/cmkllogo.png"),
                                                transformation: {
                                                    width: 90,
                                                    height: 90
                                                }
                                            })
                                        ],
                                        alignment: "right"
                                    })
                
                                ]
                            })
                        },
                        footers: {
                            default: new Footer({
                                children: [
                                    new Paragraph({
                                        border: {
                                            top: {
                                                color: "auto",
                                                space: 1,
                                                value: "single",
                                                size: 6
                                            }
                                        },
                                        children: [
                                            new TextRun({
                                                text: company,
                                                bold: true,
                                            })
                                        ],
                                        
                                        alignment: "center",
                
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                text: "BUSINESS CONFIDENTIAL"
                                            }),
                                        ],
                                        alignment: "center"
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                children: ["Page ", PageNumber.CURRENT],
                                            }),
                                            new TextRun({
                                                children: [" of ", PageNumber.TOTAL_PAGES],
                                            })
                                        ],
                                        alignment: "right"
                                    })
                                ],
                            }),
                            
                        },
                        children:[
                            new Paragraph({
                                text: "Assessment Overview",
                                heading: HeadingLevel.HEADING_1
                            }),
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: "SEC engaged CMKL to evaluate the security posture of its infrastructure compared to current industry best practices that included an external penetration test.  All testing performed is based on the NIST ",
                                        size: 24
                                    }),
                                    new TextRun({
                                        text: "NIST SP 800-115 Technical Guide to Information Security Testing and Assessment, OWASP Testing Guide (v4), and customized testing frameworks.",
                                        size: 24,
                                        italics: true,
                                    })
                                ],
                                spacing: {after: 150}
                            }),
                            new Paragraph({
                                children:[
                                    new TextRun({
                                        text: "Phases of penetration testing activities include the following:",
                                        size: 24
                                    })
                                ],
                                spacing: {after: 150}
                            }),
                            new Paragraph({
                                text: "Planning – Customer goals are gathered and rules of engagement obtained.",
                                style: "2",
                                bullet: {level: 0}                
                            }),
                            new Paragraph({
                                text: "Discovery – Perform scanning and enumeration to identify potential vulnerabilities, weak areas, and exploits.",
                                style: "2",
                                bullet: {level: 0}
                            }),
                            new Paragraph({
                                text: "Attack – Confirm potential vulnerabilities through exploitation and perform additional discovery upon new access",
                                style: "2",
                                bullet: {level: 0}
                            }),
                            new Paragraph({
                                text: "Reporting – Document all found vulnerabilities and exploits, failed attempts, and company strengths and weaknesses.",
                                style: "default",
                                bullet: {level: 0}
                            }),
                            new Paragraph({
                                text: "Assessment Components",
                                heading: HeadingLevel.HEADING_1
                            }),
                            new Paragraph({
                                text: "External Penetration Test",
                                heading: HeadingLevel.HEADING_2
                            }),
                            new Paragraph({
                                text: "An external penetration test emulates the role of an attacker attempting to gain access to an internal network without internal resources or inside knowledge.  A CMKL engineer attempts to gather sensitive information through open-source intelligence (OSINT), including employee information, historical breached passwords, and more that can be leveraged against external systems to gain internal network access.  The engineer also performs scanning and enumeration to identify potential vulnerabilities in hopes of exploitation.",
                                style: "default"
                            })
                        ]
                    },
                    {
                        headers :{
                            default: new Header({
                                children: [
                                    new Paragraph({
                                        border: {
                                            bottom: {
                                                    color: "auto",
                                                    space: 1,
                                                    value: "single",
                                                    size: 6,
                                            }
                                        },
                                        children: [
                                            new ImageRun({
                                                data: fs.readFileSync("/home/anathema/Desktop/cmkllogo.png"),
                                                transformation: {
                                                    width: 90,
                                                    height: 90
                                                }
                                            })
                                        ],
                                        alignment: "right"
                                    })
                
                                ]
                            })
                        },
                        footers: {
                            default: new Footer({
                                children: [
                                    new Paragraph({
                                        border: {
                                            top: {
                                                color: "auto",
                                                space: 1,
                                                value: "single",
                                                size: 6
                                            }
                                        },
                                        children: [
                                            new TextRun({
                                                text: company,
                                                bold: true,
                                            })
                                        ],
                                        
                                        alignment: "center",
                
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                text: "BUSINESS CONFIDENTIAL"
                                            }),
                                        ],
                                        alignment: "center"
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                children: ["Page ", PageNumber.CURRENT],
                                            }),
                                            new TextRun({
                                                children: [" of ", PageNumber.TOTAL_PAGES],
                                            })
                                        ],
                                        alignment: "right"
                                    })
                                ],
                            }),
                            
                        },
                        properties: {
                            type: SectionType.NEXT_PAGE
                        },
                        children: [
                            new Paragraph({
                                text: "Finding Severity Ratings",
                                heading: HeadingLevel.HEADING_1
                            }),
                            new Paragraph({
                                text: "The following table defines levels of severity and corresponding CVSS score range that are used throughout the document to assess vulnerability and risk impact.",
                                style: "default"
                            }),
                            new Table({
                                width: {
                                    size: 9500,
                                    type: WidthType.DXA
                                },
                                rows: [
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Severity",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "CVSS V3 Score Range",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Definition",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Critical",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "left"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "9.0-10.0",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Exploitation is straightforward and usually results in system-level compromise. It is advised to form a plan of action and patch immediately.",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "High",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "left"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "7.0-8.9",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Exploitation is more difficult but could cause elevated privileges and potentially a loss of data or downtime. It is advised to form a plan of action and patch as soon as possible.",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Moderate",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "left"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "4.0-6.9",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Vulnerabilities exist but are not exploitable or require extra steps such as social engineering. It is advised to form a plan of action and patch after high-priority issues have been resolved.",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Low",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "left"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "0.1-3.9",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Vulnerabilities are non-exploitable but would reduce an organization’s attack surface. It is advised to form a plan of action and patch during the next maintenance window",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Informational",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "left"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "N/A",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "No vulnerability exists. Additional information is provided regarding items noticed during testing, strong controls, and additional documentation.",
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                ]
                            })
                        ]
                    },
                    {
                        properties: {
                            type: SectionType.NEXT_PAGE
                        },
                        headers :{
                            default: new Header({
                                children: [
                                    new Paragraph({
                                        border: {
                                            bottom: {
                                                    color: "auto",
                                                    space: 1,
                                                    value: "single",
                                                    size: 6,
                                            }
                                        },
                                        children: [
                                            new ImageRun({
                                                data: fs.readFileSync("/home/anathema/Desktop/cmkllogo.png"),
                                                transformation: {
                                                    width: 90,
                                                    height: 90
                                                }
                                            })
                                        ],
                                        alignment: "right"
                                    })
                
                                ]
                            })
                        },
                        footers: {
                            default: new Footer({
                                children: [
                                    new Paragraph({
                                        border: {
                                            top: {
                                                color: "auto",
                                                space: 1,
                                                value: "single",
                                                size: 6
                                            }
                                        },
                                        children: [
                                            new TextRun({
                                                text: company,
                                                bold: true,
                                            })
                                        ],
                                        
                                        alignment: "center",
                
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                text: "BUSINESS CONFIDENTIAL"
                                            }),
                                        ],
                                        alignment: "center"
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                children: ["Page ", PageNumber.CURRENT],
                                            }),
                                            new TextRun({
                                                children: [" of ", PageNumber.TOTAL_PAGES],
                                            })
                                        ],
                                        alignment: "right"
                                    })
                                ],
                            }),
                            
                        },
                        children: [
                            new Paragraph({
                                text: "Scope",
                                heading: HeadingLevel.HEADING_1
                            }),
                            new Table({
                                width: {
                                    size: 9500,
                                    type: WidthType.DXA
                                },
                                rows: [
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Assessment",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Details",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "External Penetration Test"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: company_domain
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    })
                                ]
                            }),
                            new Paragraph({
                                text: "Scope Exclusions",
                                heading: HeadingLevel.HEADING_2
                            }),
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: "Per client request, CMKL did not perform any Denial of Service or Social Engineering attacks like phishing during testing."
                                    })
                                ],
                                spacing: {after: 200}
                            }),
                            new Paragraph({
                                text: "Client Allowances",
                                heading: HeadingLevel.HEADING_2
                            }),
                            new Paragraph({
                                text: `${company} did not provide any allowances to assist the testing.`
                            })
                        ]
                    },
                    {
                        properties: {
                            type: SectionType.NEXT_PAGE
                        },
                        headers :{
                            default: new Header({
                                children: [
                                    new Paragraph({
                                        border: {
                                            bottom: {
                                                    color: "auto",
                                                    space: 1,
                                                    value: "single",
                                                    size: 6,
                                            }
                                        },
                                        children: [
                                            new ImageRun({
                                                data: fs.readFileSync("/home/anathema/Desktop/cmkllogo.png"),
                                                transformation: {
                                                    width: 90,
                                                    height: 90
                                                }
                                            })
                                        ],
                                        alignment: "right"
                                    })
                
                                ]
                            })
                        },
                        footers: {
                            default: new Footer({
                                children: [
                                    new Paragraph({
                                        border: {
                                            top: {
                                                color: "auto",
                                                space: 1,
                                                value: "single",
                                                size: 6
                                            }
                                        },
                                        children: [
                                            new TextRun({
                                                text: company,
                                                bold: true,
                                            })
                                        ],
                                        
                                        alignment: "center",
                
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                text: "BUSINESS CONFIDENTIAL"
                                            }),
                                        ],
                                        alignment: "center"
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                children: ["Page ", PageNumber.CURRENT],
                                            }),
                                            new TextRun({
                                                children: [" of ", PageNumber.TOTAL_PAGES],
                                            })
                                        ],
                                        alignment: "right"
                                    })
                                ],
                            }),
                            
                        },
                        children: [
                            new Paragraph({
                                text: "Executive Summary",
                                heading: HeadingLevel.HEADING_1
                            }),
                            new Paragraph({
                                text:`CMKL evaluated ${company}'s external security posture through an external network penetration test on ${new Date()}. By leveraging a series of attacks, CMKL found the following results as shown below. It is highly recommended that ${company} address any critical vulnerability found as soon as possible as the vulnerabilities are easily found through basic reconnaissance and exploitable without much effort.`,
                                style: "default"
                            }),
                            new Paragraph({
                                text: "Attack Summary",
                                heading: HeadingLevel.HEADING_2
                            }),
                            new Paragraph({
                                text: "The following table describes how CMKL conducted the tests, step by step:",
                                style: "default"
                            }),
                            new Table({
                                width: {
                                    size: 9500,
                                    type: WidthType.DXA
                                },
                                rows: [
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Step",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Action",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text: "Recommendation",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "1"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Obtained historical breached account credentials to leverage against all company login pages"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Discourage employees from using work e-mails and usernames as login credentials to other services unless necessary"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "2"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Conducted service scanning and vulnerability assessment"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Enable service and ping scanning notifications. Ports should be filtered from public using firewalls. Services should be updated frequently"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "3"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Server scanning for hidden directories and web content and missing headers in requests and responses"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Add additional security-related headers to implementation of server. Unused web content and cgi-bins should not be left on the server for anyone to see."
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "4"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Man-in-the-middle attack proof check by making sure HSTS certificate is present in the response of server"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: "Prevents HTTPS downgrading attacks, should always be present."
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height: {value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                ]
                            }),
                        ]
                    },
                    {
                        properties:{type: SectionType.NEXT_PAGE},
                        headers :{
                            default: new Header({
                                children: [
                                    new Paragraph({
                                        border: {
                                            bottom: {
                                                    color: "auto",
                                                    space: 1,
                                                    value: "single",
                                                    size: 6,
                                            }
                                        },
                                        children: [
                                            new ImageRun({
                                                data: fs.readFileSync("/home/anathema/Desktop/cmkllogo.png"),
                                                transformation: {
                                                    width: 90,
                                                    height: 90
                                                }
                                            })
                                        ],
                                        alignment: "right"
                                    })
                
                                ]
                            })
                        },
                        footers: {
                            default: new Footer({
                                children: [
                                    new Paragraph({
                                        border: {
                                            top: {
                                                color: "auto",
                                                space: 1,
                                                value: "single",
                                                size: 6
                                            }
                                        },
                                        children: [
                                            new TextRun({
                                                text: company,
                                                bold: true,
                                            })
                                        ],
                                        
                                        alignment: "center",
                
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                text: "BUSINESS CONFIDENTIAL"
                                            }),
                                        ],
                                        alignment: "center"
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                children: ["Page ", PageNumber.CURRENT],
                                            }),
                                            new TextRun({
                                                children: [" of ", PageNumber.TOTAL_PAGES],
                                            })
                                        ],
                                        alignment: "right"
                                    })
                                ],
                            }),
                            
                        },
                        children: [
                            new Paragraph({
                                text: "External Pentest Findings",
                                heading: HeadingLevel.HEADING_1
                            }),
                            new Paragraph({
                                text: "Vulnerabilities by CVE IDs",
                                heading: HeadingLevel.HEADING_2
                            }),
                            vulns
                        ]
                    },
                    {
                        properties: {type: SectionType.NEXT_PAGE},
                        headers :{
                            default: new Header({
                                children: [
                                    new Paragraph({
                                        border: {
                                            bottom: {
                                                    color: "auto",
                                                    space: 1,
                                                    value: "single",
                                                    size: 6,
                                            }
                                        },
                                        children: [
                                            new ImageRun({
                                                data: fs.readFileSync("/home/anathema/Desktop/cmkllogo.png"),
                                                transformation: {
                                                    width: 90,
                                                    height: 90
                                                }
                                            })
                                        ],
                                        alignment: "right"
                                    })
                
                                ]
                            })
                        },
                        footers: {
                            default: new Footer({
                                children: [
                                    new Paragraph({
                                        border: {
                                            top: {
                                                color: "auto",
                                                space: 1,
                                                value: "single",
                                                size: 6
                                            }
                                        },
                                        children: [
                                            new TextRun({
                                                text: company,
                                                bold: true,
                                            })
                                        ],
                                        
                                        alignment: "center",
                
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                text: "BUSINESS CONFIDENTIAL"
                                            }),
                                        ],
                                        alignment: "center"
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                children: ["Page ", PageNumber.CURRENT],
                                            }),
                                            new TextRun({
                                                children: [" of ", PageNumber.TOTAL_PAGES],
                                            })
                                        ],
                                        alignment: "right"
                                    })
                                ],
                            }),
                            
                        },
                        children: [
                            new Paragraph({
                                text: "Data Breach Findings",
                                heading: HeadingLevel.HEADING_2,
                                spacing: {before: 200}
                            }),
                            breach,
                            new Paragraph({
                                text: "Strict Transport Security (HSTS) Check",
                                heading: HeadingLevel.HEADING_2,
                                spacing: {before: 200}
                            }),
                            new Paragraph({
                                text: hsts_message,
                                style: "default"
                            })
                        ]
                    },
                    {
                        properties: {type: SectionType.NEXT_PAGE},
                        headers :{
                            default: new Header({
                                children: [
                                    new Paragraph({
                                        border: {
                                            bottom: {
                                                    color: "auto",
                                                    space: 1,
                                                    value: "single",
                                                    size: 6,
                                            }
                                        },
                                        children: [
                                            new ImageRun({
                                                data: fs.readFileSync("/home/anathema/Desktop/cmkllogo.png"),
                                                transformation: {
                                                    width: 90,
                                                    height: 90
                                                }
                                            })
                                        ],
                                        alignment: "right"
                                    })
                
                                ]
                            })
                        },
                        footers: {
                            default: new Footer({
                                children: [
                                    new Paragraph({
                                        border: {
                                            top: {
                                                color: "auto",
                                                space: 1,
                                                value: "single",
                                                size: 6
                                            }
                                        },
                                        children: [
                                            new TextRun({
                                                text: company,
                                                bold: true,
                                            })
                                        ],
                                        
                                        alignment: "center",
                
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                text: "BUSINESS CONFIDENTIAL"
                                            }),
                                        ],
                                        alignment: "center"
                                    }),
                                    new Paragraph({
                                        children: [
                                            new TextRun({
                                                children: ["Page ", PageNumber.CURRENT],
                                            }),
                                            new TextRun({
                                                children: [" of ", PageNumber.TOTAL_PAGES],
                                            })
                                        ],
                                        alignment: "right"
                                    })
                                ],
                            }),
                            
                        },
                        children: [
                            new Paragraph({
                                text: "Cyber Risk & Cyber Confidence Index",
                                heading: HeadingLevel.HEADING_1
                            }),
                            new Paragraph({
                                text: "Overview",
                                heading: HeadingLevel.HEADING_2
                            }),
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: "The Cyber risk is calculated using our pre-trained machine learning model which takes into consideration several factors such as "
                                    }),
                                    new TextRun({
                                        text: "total vulnerabilities found, severity of vulnerabilities and the availability of exploits for these.",
                                        italics: true
                                    }),
                                    new TextRun({
                                        text: "It is an important metric to take into consideration while making IT decisions in the company. It is always recommended to reduce or fix the cyber risk as soon as reported."
                                    })
                                ],
                                spacing: {after: 175}
                            }),
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: "The "
                                    }),
                                    new TextRun({
                                        text: "Cyber Confidence Index ",
                                        bold: true
                                    }),
                                    new TextRun({
                                        text: "is another factor to keep in mind while making IT decisions. This index comes from a comprehensive formula which takes into account factors such as "
                                    }),
                                    new TextRun({
                                        text: "the cyber risk and the effort rate. ",
                                        italics:true
                                    }),
                                    new TextRun({
                                        text: "Together they inform about the consumer's and investor's confidence in the cyber assets of the company in question. Needless to say these should be in good shape through every run of a cyber security assessment so that the confidence does not drop.",
                                        style: "default"
                                    })
                                ]
                            }),
                            new Paragraph({
                                text: "The cyber risk and the confidence index by the end of this testing phase is as follows -",
                                style: "default"
                            }),
                            new Table({
                                width: {
                                    size: 9500,
                                    type: WidthType.DXA
                                },
                                rows: [
                                    new TableRow({
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text:"Metric",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text:"Score",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text:"Meaning",
                                                                bold: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                        ],
                                        height:{value: 500, rule: HeightRule.ATLEAST}
                                    }),
                                    new TableRow({
                                        height:{value: 500, rule: HeightRule.ATLEAST},
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text:"Cyber Risk",
                                                                bold: true,
                                                                italics: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: cyberrisk,
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: cyber_rating,
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ]
                                    }),
                                    new TableRow({
                                        height:{value: 500, rule: HeightRule.ATLEAST},
                                        children: [
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        children: [
                                                            new TextRun({
                                                                text:"Cyber Confidence Index",
                                                                bold: true,
                                                                italics: true
                                                            })
                                                        ],
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: conf_score,
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            }),
                                            new TableCell({
                                                children: [
                                                    new Paragraph({
                                                        text: conf_rating,
                                                        alignment: "center"
                                                    })
                                                ],
                                                verticalAlign: VerticalAlign.CENTER
                                            })
                                        ]
                                    })
                                ]
                            })
                        ]
                    }
                ]
                });
                // console.log(doc);
                // console.log(company);
                Packer.toBuffer(doc).then((buffer) => {
                    fs.writeFileSync(`Test.docx`, buffer);
                });
            
            });
        });
    });

    

    
}

//GET route
app.get('/starttest/:domain/:ip/:company_name/:company_domain/:admin_email', (req, res) => {
    req_type = 'http';
    console.log('Received a request...');
    target = req.params.domain + "." + req.params.ip;
    console.log(req.params);
    company = req.params.company_name;
    company_domain = req.params.company_domain;
    admin_email = req.params.admin_email;
    console.log('Target IP:' + target);
    res.send("Done");
    main();
    
});

//START SERVER
app.listen(3005, () => {
    console.log('Server started...');
});